#include "stm32f4xx.h"
/* ??????, ???????? ???????? ????? ?????? ?????????? ? DAC ???? ???????? ????? */
const uint16_t sin1[32] = {
 2047, 2447, 2831, 3185, 3498, 3750, 3939, 4056, 4095, 4056,
 3939, 3750, 3495, 3185, 2831, 2447, 2047, 1647, 1263, 909,
 599, 344, 155, 38, 0, 38, 155, 344, 599, 909, 1263, 1647};
unsigned char i=0;
 
int main(void) {
	GPIO_InitTypeDef GPIO_InitStructure;
  /* ???????? ???? ? */
  RCC_APB2PeriphClockCmd(RCC_AHB1Periph_GPIOA, ENABLE);
  /* ???????? ??? */
  RCC_APB1PeriphClockCmd(RCC_APB1Periph_DAC, ENABLE);
  /* ???????? ?????? 6 */
  RCC_APB1PeriphClockCmd(RCC_APB1Periph_TIM6,ENABLE);
 
  /* ??????????? ???? ???? */
  
  GPIO_InitStructure.GPIO_Pin = GPIO_Pin_4;
  GPIO_InitStructure.GPIO_Mode = GPIO_Mode_AIN;
  GPIO_Init(GPIOA, &GPIO_InitStructure);
 
  /* ??????????? ?????? ??? ???? ?? ????? ?????? */
  TIM6->PSC = 0;
  TIM6->ARR = 500;
  TIM6->DIER |= TIM_DIER_UIE; //????????? ?????????? ?? ???????
  TIM6->CR1 |= TIM_CR1_CEN; // ?????? ??????!
  NVIC_EnableIRQ(TIM6_DAC_IRQn); //?????????? TIM6_DAC_IRQn ??????????
 
  /* ???????? DAC1 */
  DAC->CR |= DAC_CR_EN1;
 
  /* ??????????? ???? */
  while (1)
  {
  }
}
 
/*?????????? ?????????? ?? ??????? 6 */
void TIM6_DAC_IRQHandler(void) {
  TIM6->SR &= ~TIM_SR_UIF; //?????????? ???? UIF
  DAC->DHR12R1=sin1[i++]; //?????????? ? ??? ????????? ??????? ???????
  if (i==32) i=0; //???? ?????? ? ??? ??? 32 ???????? ?? ???????? ??????
}
